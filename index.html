<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Content Security Policy: 阻止所有baidu相关的资源 -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://teamface.fszi.org; script-src 'self' https://teamface.fszi.org 'unsafe-inline' 'unsafe-eval'; style-src 'self' https://teamface.fszi.org 'unsafe-inline'; img-src 'self' https://teamface.fszi.org data: https:; font-src 'self' https://teamface.fszi.org data:; connect-src 'self' https://teamface.fszi.org; frame-src 'self' https://teamface.fszi.org; object-src 'none'; base-uri 'self'; form-action 'self' https://teamface.fszi.org;">
</head>
<body style="margin:0;padding:0;overflow:hidden;">
    <iframe 
        id="signin-frame"
        src="https://teamface.fszi.org/dist/H5.html#/SI/GXZxhJVWv.GXZxhJVWv.2.303.bean1569488964591.1.0.teamface_id"
        style="width:100%;height:100vh;border:none;display:block;"
        sandbox="allow-same-origin allow-scripts allow-forms"
        allow="fullscreen"
    ></iframe>
    
    <script id="blocker-script">
        // 这个脚本将被注入到iframe中
        (function() {
            // 阻止所有弹窗
            window.alert = function() {};
            window.confirm = function() { return false; };
            window.prompt = function() { return null; };
            window.open = function() { return null; };
            if (window.showModalDialog) {
                window.showModalDialog = function() { return null; };
            }
            
            // 阻止baidu相关的脚本执行
            const originalCreateElement = document.createElement;
            document.createElement = function(tagName) {
                const element = originalCreateElement.apply(this, arguments);
                if (tagName.toLowerCase() === 'script') {
                    const originalSetAttribute = element.setAttribute;
                    element.setAttribute = function(name, value) {
                        if (name === 'src' && typeof value === 'string' && (value.includes('baidu') || value.includes('bdstatic'))) {
                            return;
                        }
                        return originalSetAttribute.apply(this, arguments);
                    };
                }
                return element;
            };
            
            // 拦截fetch和XHR
            const originalFetch = window.fetch;
            window.fetch = function(...args) {
                const url = args[0];
                if (typeof url === 'string' && (url.includes('baidu') || url.includes('bdstatic'))) {
                    return Promise.reject(new Error('Blocked'));
                }
                return originalFetch.apply(this, args);
            };
            
            const originalXHROpen = XMLHttpRequest.prototype.open;
            XMLHttpRequest.prototype.open = function(method, url) {
                if (typeof url === 'string' && (url.includes('baidu') || url.includes('bdstatic'))) {
                    return;
                }
                return originalXHROpen.apply(this, arguments);
            };
            
            // 定期检查并重新应用拦截（防止被覆盖）
            setInterval(function() {
                if (window.alert && window.alert.toString().indexOf('native') !== -1) {
                    window.alert = function() {};
                }
                if (window.confirm && window.confirm.toString().indexOf('native') !== -1) {
                    window.confirm = function() { return false; };
                }
                if (window.prompt && window.prompt.toString().indexOf('native') !== -1) {
                    window.prompt = function() { return null; };
                }
                if (window.open && window.open.toString().indexOf('native') !== -1) {
                    window.open = function() { return null; };
                }
            }, 50);
        })();
    </script>

    <script>
        // 注册Service Worker拦截baidu请求
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js').catch(function() {});
            });
        }

        // 阻止所有baidu相关的请求和脚本执行
        (function() {
            // 拦截fetch请求
            const originalFetch = window.fetch;
            window.fetch = function(...args) {
                const url = args[0];
                if (typeof url === 'string' && (url.includes('baidu') || url.includes('bdstatic'))) {
                    return Promise.reject(new Error('Blocked'));
                }
                return originalFetch.apply(this, args);
            };

            // 拦截XMLHttpRequest
            const originalOpen = XMLHttpRequest.prototype.open;
            XMLHttpRequest.prototype.open = function(method, url, ...rest) {
                if (typeof url === 'string' && (url.includes('baidu') || url.includes('bdstatic'))) {
                    return;
                }
                return originalOpen.apply(this, [method, url, ...rest]);
            };

            // 阻止动态创建baidu相关的script标签
            const originalCreateElement = document.createElement;
            document.createElement = function(tagName, ...rest) {
                const element = originalCreateElement.apply(this, [tagName, ...rest]);
                if (tagName.toLowerCase() === 'script') {
                    const originalSetAttribute = element.setAttribute;
                    element.setAttribute = function(name, value) {
                        if (name === 'src' && typeof value === 'string' && (value.includes('baidu') || value.includes('bdstatic'))) {
                            return;
                        }
                        return originalSetAttribute.apply(this, arguments);
                    };
                }
                return element;
            };

            // 阻止通过innerHTML插入baidu脚本
            const originalInnerHTML = Object.getOwnPropertyDescriptor(Element.prototype, 'innerHTML');
            Object.defineProperty(Element.prototype, 'innerHTML', {
                set: function(value) {
                    if (typeof value === 'string' && (value.includes('baidu') || value.includes('bdstatic')) && value.includes('<script')) {
                        value = value.replace(/<script[^>]*(baidu|bdstatic)[^>]*>[\s\S]*?<\/script>/gi, '');
                    }
                    originalInnerHTML.set.call(this, value);
                },
                get: originalInnerHTML.get
            });

            // 拦截window.open阻止弹窗
            const originalWindowOpen = window.open;
            window.open = function(url, name, features) {
                if (typeof url === 'string' && (url.includes('baidu') || url.includes('bdstatic'))) {
                    return null;
                }
                // 阻止所有新窗口弹窗（如果需要允许某些弹窗，可以在这里添加白名单）
                return null;
            };

            // 监听iframe加载完成并注入拦截脚本
            const iframe = document.getElementById('signin-frame');
            const blockerScript = document.getElementById('blocker-script').textContent;
            
            function injectBlocker() {
                try {
                    const iframeWindow = iframe.contentWindow;
                    const iframeDoc = iframe.contentDocument || iframeWindow.document;
                    
                    if (iframeDoc && iframeWindow) {
                        // 直接注入拦截脚本
                        try {
                            const script = iframeDoc.createElement('script');
                            script.textContent = blockerScript;
                            (iframeDoc.head || iframeDoc.documentElement).appendChild(script);
                            
                            // 同时直接重写弹窗方法
                            iframeWindow.alert = function() {};
                            iframeWindow.confirm = function() { return false; };
                            iframeWindow.prompt = function() { return null; };
                            iframeWindow.open = function() { return null; };
                            if (iframeWindow.showModalDialog) {
                                iframeWindow.showModalDialog = function() { return null; };
                            }
                        } catch (e) {}
                        
                        // 移除所有baidu相关的script标签
                        const scripts = iframeDoc.querySelectorAll('script');
                        scripts.forEach(script => {
                            if (script.src && (script.src.includes('baidu') || script.src.includes('bdstatic'))) {
                                script.remove();
                            } else if (script.textContent && (script.textContent.includes('baidu') || script.textContent.includes('bdstatic'))) {
                                script.textContent = '';
                            }
                        });
                        
                        // 监听iframe内部的DOM变化
                        const observer = new MutationObserver(function(mutations) {
                            mutations.forEach(function(mutation) {
                                mutation.addedNodes.forEach(function(node) {
                                    if (node.nodeName === 'SCRIPT') {
                                        if (node.src && (node.src.includes('baidu') || node.src.includes('bdstatic'))) {
                                            node.remove();
                                        } else if (node.textContent && (node.textContent.includes('baidu') || node.textContent.includes('bdstatic'))) {
                                            node.textContent = '';
                                        }
                                    }
                                });
                            });
                        });
                        observer.observe(iframeDoc.body || iframeDoc.documentElement, {
                            childList: true,
                            subtree: true
                        });
                        
                        // 定期检查并重新应用拦截
                        setInterval(function() {
                            try {
                                if (iframeWindow.alert && iframeWindow.alert.toString().indexOf('native') !== -1) {
                                    iframeWindow.alert = function() {};
                                }
                                if (iframeWindow.confirm && iframeWindow.confirm.toString().indexOf('native') !== -1) {
                                    iframeWindow.confirm = function() { return false; };
                                }
                                if (iframeWindow.prompt && iframeWindow.prompt.toString().indexOf('native') !== -1) {
                                    iframeWindow.prompt = function() { return null; };
                                }
                                if (iframeWindow.open && iframeWindow.open.toString().indexOf('native') !== -1) {
                                    iframeWindow.open = function() { return null; };
                                }
                            } catch (e) {}
                        }, 50);
                    }
                } catch (e) {
                    // 跨域限制，无法直接注入
                }
            }
            
            // 立即尝试注入（如果iframe已加载）
            if (iframe.contentDocument && iframe.contentDocument.readyState === 'complete') {
                injectBlocker();
            }
            
            // 监听iframe加载完成
            iframe.addEventListener('load', injectBlocker);
            
            // 多次尝试注入（处理动态加载）
            setTimeout(injectBlocker, 100);
            setTimeout(injectBlocker, 500);
            setTimeout(injectBlocker, 1000);
            setTimeout(injectBlocker, 2000);
        })();
    </script>
</body>
</html>

